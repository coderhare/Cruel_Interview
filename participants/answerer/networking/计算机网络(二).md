## 计算机网络（二） 网络编程部分

**1. 请说说socket网络编程的步骤?**

- 服务器根据地址类型（ ipv4, ipv6 ）、 socket 类型、协议创建 socket。

- 服务器为 socket 绑定 IP 地址和端口号。

- 服务器 socket 监听端口号请求，随时准备接收客户端发来的连接，这时候服务器的socket 并没有被打开 。

- 客户端创建 socket。

- 客户端打开 socket，根据服务器 IP 地址和端口号试图连接服务器 socket。

- 服务器 socket 接收到客户端 socket 请求，被动打开，开始接收客户端请求，直到客户端返回连接信息 。这时候 socket 进入阻塞状态，所谓阻塞即accept（）方法一直到客户端返回连接信息后才返回，开始接收下一个客户端连接请求 。

- 客户端连接成功，向服务器发送连接状态信息 。

- 服务器 accept 方法返回，连接成功 。

- 客户端向 socket 写入信息 。

- 服务器读取信息 。

- 客户端关闭 。

- 服务器端关闭 。

**2.请说说socket网络编程的接口?**

- socket函数创建接口

- bind函数绑定IP地址和端口号

- listen函数监听

- accept接受客户端请求

- close函数关闭socket

- connect函数是客户端请求

- read和write函数用来读取和发送数据

**3.什么是TCP粘包现象？**

在socket网络程序中，
发送端为了将多个发往接收端的包，更有效的发到对方，使用了优化方法（Nagle算法），将多次间隔较小、数据量小的数据，合并成一个大的数据块，然后进行封包。
或者接收端接收不及时，造成TCP缓冲区中存放多段数据。
这两种情况都会出现TCP粘包问题。

**4.为什么会出现粘包现象？如何解决?**

由Nagle算法造成的发送端粘包。Nagle算法是一种改善网络传输效率的算法，但也可能造成困扰。这就造成了粘包。
接收端接收不及时造成的接收端粘包。TCP会把接收到的数据存在自己的缓冲区中，然后通知应用层取数据。当应用层由于某些原因不能及时取出TCP的数据，就会造成TCP缓冲区中存放多段数据。
解决办法是：科学封包和解包。

**5.简述一下Nagle算法**

Nagle算法简单的说，当提交一段数据给TCP时，TCP并不立刻发送此段数据，而是等待一段时间，看看在等待期间是否还有要发送的数据，若有则会一次把多段数据发送出去。

**6.为什么UDP不粘包?**

对于UDP，不会使用块的合并优化算法，不存在封包，再加上UDP本身是一个“数据包“协议，也就是两段数据是有界限的。从TCP和UDP的头部结构体就可以很明显的看到，UDP头部是记录了数据的长度的，而TCP头部里面并没有记录数据长度的变量。

**7.什么是封包和解包？**

封包就是给一段数据加上包头，这样一来数据包就分为包头和包体两部分内容了（可加上包尾）。包头其实是一个大小固定的结构体，其中有个结构体成员变量表示包体的长度，这是个很重要的变量，其他的结构体成员可根据需要自己定义。根据固定的包头长度以及包头中含有的包体长度变量值就能正确的拆分出一个完整的数据包。

利用底层的缓冲区来进行解包时，由于TCP也维护了一个缓冲区，所以可以利用TCP的缓冲区来解包，也就是循环不停地接收包头给出的数据，直到收够为止，这就是一个完整的TCP包。
