## 一、写在前面

消息队列，笔记暂存

## 二、消息队列

消息队列，常用与解耦或异步处理。



离线消息队列--kafka，BMQ

BMQ完全兼容kafka协议，在客户端使用没有区别。



较差模式；某系统中去通知其他服务。每个服务接入都需要重新改代码调用某Service的接口



发布订阅模式，不一定是发布者通知，也可能是订阅者主动去捞取

![image-20220422130115527](/Users/bytedance/Library/Application Support/typora-user-images/image-20220422130115527.png)

完全解耦，扩展性高





基本概念



每个partition只会被分配给一个消费者实例

所以假设有十个业务实例，那么申请的partition一定要>=10才可以。只能扩容不能缩容。



监控指标

整个topic的lag情况  如果增加 说明消费者没有在消费 要检查消费的业务是否正常运行。

  

单个partition 流量大于5MB 说明需要扩容  即 入流>partition*5MB 则说明需要扩容。



管理权限（对用户 人）和读写权限（对服务）



生产者生产消息 一般用异步模式，如果要保证消息严格有序，则可以选择同步的方式



kafkaConsumer非线程安全，所以最好初始化完Consumer后放到一个线程安全的队列里面，然后再多线程运行消费。

